# CLI WiFi 功能说明

## 概述

本项目实现了一个完整的命令行界面(CLI)，用于管理WiFi连接和设备配置。CLI具有智能的活动超时机制，可以自动管理WiFi后台扫描功能。

## 主要功能

### 1. WiFi 管理功能

#### 1.1 WiFi 状态查看
- 显示当前WiFi连接状态
- 显示连接的SSID、信号强度(RSSI)
- 显示IP地址、网关、连接时长等信息

#### 1.2 WiFi 网络扫描
- 扫描周围可用的WiFi网络
- 显示网络名称(SSID)和信号强度

#### 1.3 WiFi 连接/断开
- 手动连接到指定的WiFi网络
- 支持输入SSID和密码
- 断开当前WiFi连接

#### 1.4 WiFi 连接记录管理
- 查看已保存的WiFi连接记录
- 添加新的WiFi连接记录
- 删除指定的WiFi连接记录
- 记录包含连接历史信息(是否曾经连接成功)

### 2. 活动超时机制

#### 2.1 活动状态管理
- 当用户与CLI交互时，系统进入"活动状态"
- 活动状态下，WiFi后台自动扫描功能被禁用
- 避免CLI操作与后台扫描冲突

#### 2.2 超时自动返回
- 如果用户在1分钟内没有任何输入，系统自动超时
- 超时后自动返回主菜单
- 重新启用WiFi后台自动扫描功能

#### 2.3 智能扫描控制
- 非活动状态：启用后台扫描，自动连接已知网络
- 活动状态：禁用后台扫描，避免干扰用户操作

### 3. 串口波特率设置
- 支持多种标准波特率设置
- 实时显示当前波特率
- 设置完成后自动返回主菜单

## 菜单结构

```
主菜单
├── 1. WiFi Setting
│   ├── 1. Show Status      - 显示WiFi状态
│   ├── 2. Scan            - 扫描WiFi网络
│   ├── 3. Connect         - 连接WiFi网络
│   ├── 4. Disconnect      - 断开WiFi连接
│   ├── 5. List Records    - 显示连接记录
│   ├── 6. Delete Record   - 删除连接记录
│   ├── 7. Add Record      - 添加连接记录
│   └── 0. Exit            - 返回主菜单
├── 2. UART Setting        - 串口波特率设置
└── 3. About              - 关于信息
```

## 使用示例

### 连接WiFi网络
1. 选择 "1. WiFi Setting"
2. 选择 "3. Connect"
3. 输入SSID名称
4. 输入密码
5. 系统自动尝试连接

### 添加WiFi记录
1. 选择 "1. WiFi Setting"
2. 选择 "7. Add Record"
3. 输入SSID名称
4. 输入密码
5. 记录保存到NVS存储

### 查看WiFi状态
1. 选择 "1. WiFi Setting"
2. 选择 "1. Show Status"
3. 显示详细连接信息

## 技术特性

### 1. 状态机设计
- 使用状态机模式管理CLI交互流程
- 支持多级菜单和子状态
- 清晰的状态转换逻辑

### 2. 内存管理
- 动态分配扫描结果缓冲区
- 自动释放不再使用的内存
- 防止内存泄漏

### 3. 错误处理
- 完善的错误检查和提示
- 用户友好的错误信息显示
- 异常情况下的自动恢复

### 4. 并发安全
- 使用互斥锁保护共享资源
- 线程安全的WiFi操作
- 定时器安全管理

## 配置参数

- **活动超时时间**: 60秒 (可在 `CLI_ACTIVITY_TIMEOUT_MS` 中修改)
- **最大WiFi记录数**: 8个 (定义在 `WIFI_STATION_MAX_RECORDS`)
- **扫描结果缓冲区**: 20个网络
- **后台扫描间隔**: 30秒

## 注意事项

1. CLI活动期间，WiFi后台扫描会被暂停
2. 超时后会自动返回主菜单并恢复后台扫描
3. WiFi连接记录会持久化保存在NVS中
4. 系统会自动选择信号最强的已知网络进行连接 